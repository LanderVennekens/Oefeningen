(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[1086],{3708:function(e,t,n){"use strict";n.d(t,"e",function(){return a});var a=!n(5).e.isActivated("412301EB-A806-49EF-837F-4164D0D5DB49","03/27/2023","Resolve fav signal from cache")},3810:function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"n",function(){return r}),n.d(t,"t",function(){return o});var a="FAVORITES_CACHE_DIRTY";function i(){try{return!!localStorage.getItem(a)}catch(e){}return!1}function r(){try{localStorage.setItem(a,"true")}catch(e){}}function o(){try{localStorage.removeItem(a)}catch(e){}}},6207:function(e,t,n){"use strict";n.r(t),n.d(t,"FavoritesProvider",function(){return H}),n.d(t,"resourceKey",function(){return R});var a=n(0),i=n(46),r=n(715),o=n(187),s=n(6),c=n(74),d=n(415),l=n(152),u=n(263),f=n(398),p=n(1491),m=n(526),_=n(314),h=n(396),b=n(59),g=n(39),v={pageContext:i.e,identityDataSource:_.t,substrateRequestInfo:h.e,getNucleusSyncClient:f.e.optional},y=function(){function e(e,t){void 0===e&&(e={});var n=e.dataSourceName,a=void 0===n?"FavoritesEdgeworthProvider":n,i=t.pageContext;this._identityDataSource=t.identityDataSource,this._substrateRequestInfo=t.substrateRequestInfo,this._getNucleusSyncClient=t.getNucleusSyncClient,this._dataSourceName=a,this._cache=new m.e({id:this._dataSourceName},{pageContext:i}),this._version=1,this._cacheKey="".concat(this._dataSourceName,"_").concat(i.aadUserId,"_v").concat(this._version)}return e.prototype.getFavoritedItems=function(e){return Object(a.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(a.__generator)(this,function(i){switch(i.label){case 0:return t=e.cachingStrategy,[4,this._getDataUtilizingCache(Object(a.__assign)(Object(a.__assign)({},e),Object(d.e)()?{cachingStrategy:u.e.onlyCache}:{}))];case 1:return(n=i.sent())||t!==u.e.onlyCache?(null==n?void 0:n.files)&&Array.isArray(n.files)?[2,(r=n.files,r.map(D))]:[2,Promise.reject("Response not in expected format")]:[2,void 0]}var r})})},e.prototype.removeItemsFromCache=function(e){return Object(a.__awaiter)(this,void 0,void 0,function(){var t,n,i,r,o,s,d,l,f;return Object(a.__generator)(this,function(p){switch(p.label){case 0:t=e.itemIds,n=Object(a.__rest)(e,["itemIds"]),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this._getDataUtilizingCache(Object(a.__assign)(Object(a.__assign)({},n),{cachingStrategy:u.e.onlyCache,cacheTimeoutTime:0}))];case 2:if((null==(i=p.sent())?void 0:i.files)&&Array.isArray(i.files)){for(r=new Set,o=0,s=t;o<s.length;o++)d=s[o],r.add(d);l=!1,f=Object(c.n)(i,{files:i.files.filter(function(e){var t=r.has(e.id);return t&&(l=!0),!t})}),l&&this._cache.updateCache(this._getFavoritedItemsCacheRequestKey(n),f)}return[3,4];case 3:return p.sent(),[3,4];case 4:return[2]}})})},e.prototype._getDataUtilizingCache=function(e){var t=this,n=e.cachingStrategy,i=e.cacheTimeoutTime,r=Object(a.__rest)(e,["cachingStrategy","cacheTimeoutTime"]);return this._cache.getDataUtilizingCache({cachingStrategy:n,cacheRequestKey:this._getFavoritedItemsCacheRequestKey(r),cacheTimeoutTime:i,returnStatistics:!1,getData:function(){return t._getDataSource().getFavorites(r)}})},e.prototype._getDataSource=function(){if(!this._dataSource){var e=this._substrateRequestInfo,t=e.domain,n=e.metaData;this._dataSource=new p.e({domain:t,metaData:n,getAuthToken:this._getAuthToken.bind(this),dataSyncClient:Object(g.t)(l.s)&&this._getNucleusSyncClient?this._getNucleusSyncClient():void 0})}return this._dataSource},e.prototype._getAuthToken=function(){return this._identityDataSource.getSubstrateToken?Promise.resolve(this._identityDataSource.getSubstrateToken()).then(function(e){return{access_token:e.accessToken}}):Promise.reject("Provided IdentityDataSource does not implement getSubstrateToken")},e.prototype._getFavoritedItemsCacheRequestKey=function(e){var t=e.dataSources?"_".concat(e.dataSources):"";return"".concat(this._cacheKey,"_getFavoritedItems").concat(t)},e.dependencies=v,e}(),S=new s.t({name:"EdgeworthProvider",factory:new b.n(y)});function D(e){var t,n,i=null==e?void 0:e.modification_info,r=null==i?void 0:i.user_info,o=null==e?void 0:e.sharepoint_info,s=null==e?void 0:e.user_relationship;return{file:{FileExtension:null==e?void 0:e.extension,FileModifiedTime:(null==s?void 0:s.last_modified_datetime)||(null==i?void 0:i.timestamp)||"",Id:(null==e?void 0:e.id)||"",ItemProperties:Object(a.__assign)({},"OneNote"===(null==e?void 0:e.type)?{Default:{ProgID:"OneNote.Notebook"}}:{}),SharePointItem:{ContentClass:"",ContentTypeId:"",DocId:(null==o?void 0:o.doc_id)||0,ListId:(null==o?void 0:o.list_id)||"",ListItemId:"",ModifiedBy:(null==r?void 0:r.upn)||"",ModifiedByDisplayName:(null==r?void 0:r.display_name)||"",SiteId:(null==o?void 0:o.site_id)||"",UniqueId:(null==o?void 0:o.unique_id)||"",WebId:(null==o?void 0:o.web_id)||"",FileUrl:(null==e?void 0:e.url)||(null==e?void 0:e.mru_url),SitePath:null==o?void 0:o.site_path},UserRelationship:Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({LastSharedDateTime:(null==s?void 0:s.last_shared_datetime)||"",LastSharedById:(null==s?void 0:s.last_shared_by_id)||""},(null==s?void 0:s.last_access_datetime)?{LastAccessDateTime:s.last_access_datetime}:{}),(null==s?void 0:s.last_modified_datetime)?{LastModifiedDateTime:s.last_modified_datetime}:{}),(null==s?void 0:s.save_for_later_datetime)?{SaveForLaterDateTime:s.save_for_later_datetime}:{}),Visualization:{AccessUrl:(null==e?void 0:e.web_url)||"",ContainerTitle:(null==e?void 0:e.container_title)||"",ContainerUrl:(null==e?void 0:e.container_url)||"",PreviewImageUrl:"",Title:(null==e?void 0:e.title)||"",Type:(null==e?void 0:e.type)||"Unknown"},OneDriveInfo:{DriveId:(null===(t=null==e?void 0:e.onedrive_info)||void 0===t?void 0:t.drive_id)||"",ItemId:(null===(n=null==e?void 0:e.onedrive_info)||void 0===n?void 0:n.item_id)||""},IsPinned:null==e?void 0:e.is_pinned},activity:null==e?void 0:e.activity_badge}}var I=n(110),x=n(158),C=n(104),O=n(235),w=n(374),E=n(3810),A=n(3708),L=n(1574),k=function(){function e(e,t){var n=t.pageContext,i=t.dataRequestorType,r=void 0===i?function(e){function i(a){return e.call(this,a,{pageContext:n,tokenProvider:t.tokenProvider})||this}return Object(a.__extends)(i,e),i}(w.t):i,o=e.dataSourceName,s=void 0===o?"FavoritesDataSource":o;this._cache=new m.e({id:s},{pageContext:n}),this._version=2,this._cacheKey="".concat(s,"_").concat(n.aadUserId,"_v").concat(this._version),this._dataRequestor=new r({qosName:s}),this._pageContext=t.pageContext,this._getOneDriveDataSource=t.getOneDriveDataSource,this._getUserOneDriveUrl=e.getUserOneDriveUrl,this._getSharePointToken=e.getSharePointToken}return e.prototype.getFavoritedItems=function(e){return Object(a.__awaiter)(this,void 0,void 0,function(){var t,n,i,r;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return t=e.cachingStrategy,n=e.ignoreDirtyCache,i=Object(E.e)(),A.e&&t===u.e.onlyCache&&n&&i?[2,void 0]:[4,this._getDataUtilizingCache(e)];case 1:if(r=a.sent(),A.e&&t===u.e.bypassCache&&i&&Object(E.t)(),!r&&t===u.e.onlyCache)return[2,void 0];try{return r.d.GetFavoriteItems?[2,JSON.parse(r.d.GetFavoriteItems)]:[2,Promise.reject("Response not in expected format: ".concat(r))]}catch(e){return[2,Promise.reject(e)]}return[2]}})})},e.prototype.removeItemsFromCache=function(e){var t,n=e.itemIds;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,i,r,o,s,d,l,f,p;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._getDataUtilizingCache({cachingStrategy:u.e.onlyCache,cacheTimeoutTime:0})];case 1:if(e=a.sent(),null===(t=null==e?void 0:e.d)||void 0===t?void 0:t.GetFavoriteItems){for(i=JSON.parse(e.d.GetFavoriteItems),r=new Set,o=0,s=n;o<s.length;o++)d=s[o],r.add(d);l=!1,f=i.filter(function(e){var t=r.has(e.file.Id);return t&&(l=!0),!t}),l&&(p=Object(c.n)(e,{d:{GetFavoriteItems:JSON.stringify(f)}}),this._cache.updateCache(this.favoritedItemsCacheRequestKey,p))}return[3,3];case 2:return a.sent(),[3,3];case 3:return[2]}})})},e.prototype._getDataUtilizingCache=function(e){var t=this,n=e.cachingStrategy,i=e.cacheTimeoutTime,r=Object(a.__rest)(e,["cachingStrategy","cacheTimeoutTime"]);return this._cache.getDataUtilizingCache({cachingStrategy:Object(d.e)()?u.e.onlyCache:n,cacheRequestKey:this.favoritedItemsCacheRequestKey,cacheTimeoutTime:i,returnStatistics:!1,getData:function(){return t._getData(r)}})},e.prototype._getData=function(e){return Object(a.__awaiter)(this,void 0,I.n,function(){var t,n,i,r,o,s,c,d,l,u,f,p,m;return Object(a.__generator)(this,function(_){switch(_.label){case 0:return t=e.top,n=void 0===t?500:t,i=e.skipToken,r=e.noNucleusRedirection,o=void 0!==r&&r,[4,this._getWebAbsoluteUrl()];case 1:return s=_.sent(),c=new O.t({webAbsoluteUrl:s}),d=c.build().segment("sp.FavoriteItemCollection.GetFavoriteItems").parameters(Object(a.__assign)({top:n},i?{skipToken:i}:{})).toString(),u=(l=this._dataRequestor).getData,f=[{url:d,qosName:"getFavoritedItems",method:"GET",additionalHeaders:Object(a.__assign)({Caller:"ODBWeb"},o&&{nucleusRedirection:"false"}),noRedirect:!0}],L.e?(p={webAbsoluteUrl:s},[3,4]):[3,2];case 2:return m={},[4,this._getAuthToken(s)];case 3:m.authToken=_.sent(),p=m,_.label=4;case 4:return[2,u.apply(l,[a.__assign.apply(void 0,f.concat([p]))])]}})})},Object.defineProperty(e.prototype,"favoritedItemsCacheRequestKey",{get:function(){return"".concat(this._cacheKey,"_getFavoritedItems")},enumerable:!1,configurable:!0}),e.prototype._getWebAbsoluteUrl=function(){return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return void 0!==this._webAbsoluteUrl?[3,8]:this._isCurrentUsersOneDrive?(this._webAbsoluteUrl=this._pageContext.webAbsoluteUrl||"",[3,8]):[3,1];case 1:return L.e?[4,this._getOneDriveDataSource()]:[3,4];case 2:return[4,a.sent().getPersonalUrl()];case 3:return e=a.sent(),this._webAbsoluteUrl=e.endsWith("/")?e.slice(0,-1):e,[3,8];case 4:return t=this,this._getUserOneDriveUrl?[4,this._getUserOneDriveUrl()]:[3,6];case 5:return n=a.sent(),[3,7];case 6:n=this._pageContext.webAbsoluteUrl,a.label=7;case 7:t._webAbsoluteUrl=n||"",a.label=8;case 8:return[2,this._webAbsoluteUrl]}})})},e.prototype._getAuthToken=function(e){return Object(a.__awaiter)(this,void 0,void 0,function(){var t,n,i;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return this._isCurrentUsersOneDrive?[2]:(t=new x.e(e).authority,this._getSharePointToken?[4,this._getSharePointToken(t)]:[3,2]);case 1:return i=a.sent(),[3,3];case 2:i=void 0,a.label=3;case 3:return[2,null==(n=i)?void 0:n.accessToken]}})})},Object.defineProperty(e.prototype,"_isCurrentUsersOneDrive",{get:function(){return this._pageContext.isMySiteOwner&&Number(this._pageContext.webTemplate)===C.e.mySite},enumerable:!1,configurable:!0}),e}(),M=n(966),P=n(1378),T={pageContext:i.e,getOneDriveDataSource:M.e.async.lazy,tokenProvider:P.e},U=new s.t({name:"".concat("FavoritesDataSource.key",".favoritesDataSource"),factory:{dependencies:T,create:function(e){return{instance:function(t){return new k(t,e)}}}}}),F={pageContext:i.e,edgeworthProvider:S,isFavoritesV2Enabled:r.e,getFavoritesDataSource:U},H=function(){function e(e,t){var n=e.enableV2MruFallback,i=void 0!==n&&n;this._edgeworthProvider=t.edgeworthProvider,this._spoDataSource=t.getFavoritesDataSource({getUserOneDriveUrl:e.getUserOneDriveUrl,getSharePointToken:e.getSharePointToken}),this._useSpoApi=!e.bypassSpo&&t.isFavoritesV2Enabled(),this._useEdgeworthApi=!this._useSpoApi||i,this._edgeworthFavoritesParams=Object(a.__assign)(Object(a.__assign)({rs:o.t.language,top:1e3},e.edgeworthFavoritesParams||{}),this._useSpoApi?{dataSources:"mru"}:{})}return e.prototype.getFavoritedItems=function(e){return Object(a.__awaiter)(this,void 0,void 0,function(){var t,n,i,r;return Object(a.__generator)(this,function(o){switch(o.label){case 0:return[4,Promise.all([this._useEdgeworthApi?this._edgeworthProvider.getFavoritedItems(Object(a.__assign)(Object(a.__assign)({},this._edgeworthFavoritesParams),e)):Promise.resolve([]),this._useSpoApi?this._spoDataSource.getFavoritedItems(e):Promise.resolve([])])];case 1:return t=o.sent(),n=t[0],i=t[1],n&&i?(r=new Set,i.forEach(function(e){r.add(e.file.Id)}),[2,Object(a.__spreadArray)(Object(a.__spreadArray)([],i,!0),n.filter(function(e){return!r.has(e.file.Id)}),!0)]):[2,void 0]}})})},e.prototype.removeItemsFromCache=function(e){var t=e.itemIds;return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(e){switch(e.label){case 0:return[4,Promise.all([this._edgeworthProvider.removeItemsFromCache(Object(a.__assign)(Object(a.__assign)({},this._edgeworthFavoritesParams),{itemIds:t})),this._useSpoApi?this._spoDataSource.removeItemsFromCache({itemIds:t}):Promise.resolve()])];case 1:return e.sent(),[2]}})})},e.dependencies=F,e}(),R=new s.t({name:"FavoritesProvider",factory:{dependencies:F,create:function(e){return{instance:function(t){return new H(t,e)}}}}})}}]);